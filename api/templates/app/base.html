{% import "macros/nav.html" as nav %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title | default('LUVIIO | Secure Node') }}</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/unpoly@3.10.1/unpoly.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        
        body { 
            background: #050505; 
            color: white; 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            overflow-x: hidden;
        }

        /* High-Definition Progress Bar for Unpoly */
        .up-progress-bar {
            background: linear-gradient(to right, #3b82f6, #6366f1);
            height: 3px;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        /* üåå Deep Grid Effect */
        .bg-grid { 
            position: fixed; 
            inset: 0; 
            background-image: radial-gradient(rgba(255,255,255,0.05) 1px, transparent 0); 
            background-size: 40px 40px; 
            opacity: 0.5; 
            pointer-events: none; 
            z-index: -1; 
        }

        /* Custom Scrollbar for Elite look */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #1a1a1a; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #333; }
    </style>
</head>
<body class="min-h-screen flex flex-col selection:bg-blue-500/30">
    <div class="bg-grid"></div>

    {# üõ°Ô∏è HEADER: Hamesha top par rahega (Public ya Dashboard dono mein) #}
    {{ nav.render_header(active_page | default('home'), request) }}

    {# 
        üöÄ LAYOUT LOGIC: 
        Agar 'user' object present hai aur hum home/login/signup par nahi hain, 
        toh Sidebar render karo aur content ko shift karo.
    #}
    {% set is_auth_page = request.url.path in ['/login', '/signup', '/', '/waitlist'] %}
    
    <div class="flex flex-1 pt-20">
        {% if user and not is_auth_page %}
            {# Sidebar render using your macro #}
            {{ nav.render_sidebar(user) }}
            
            <main id="main-content" class="flex-1 md:pl-64 transition-all duration-500" up-main>
                <div class="p-6 lg:p-10">
                    {% block content %}{% endblock %}
                </div>
            </main>
        {% else %}
            <main id="main-content" class="flex-1 w-full" up-main>
                {% block content %}{% endblock %}
            </main>
        {% endif %}
    </div>

    <footer class="py-10 text-center text-[9px] font-black uppercase tracking-[0.5em] text-neutral-800 border-t border-white/5">
        &copy; 2026 LUVIIO ENGINE &bull; NODE ID: {{ "V4.1" if not user else user.id[:8] | upper }}
    </footer>

    <script>
        // ‚ö° GSAP Page Entry Animation
        up.on('up:content:updated', (event) => {
            gsap.from("#main-content", {
                opacity: 0,
                y: 10,
                duration: 0.4,
                ease: "power2.out"
            });
        });

        // Initial Load
        gsap.from("#main-content", {
            opacity: 0,
            y: 15,
            duration: 0.6,
            delay: 0.2,
            ease: "expo.out"
        });
    </script>
</body>
</html>