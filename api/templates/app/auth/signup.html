{% extends "app/base.html" %}
{% import "macros/auth_macros.html" as forms %}

{% block content %}
<div class="w-full max-w-[420px] px-4">
    <div id="authCard" class="card bg-[#0A0A0A]/90 border border-white/10 shadow-2xl rounded-[2rem] p-8 text-center backdrop-blur-xl">
        
        <h2 class="text-2xl font-bold text-white mb-2">Create Account</h2>
        <p class="text-xs text-neutral-500 mb-6">Start your verified journey</p>
        
        <div class="grid grid-cols-2 gap-3 mb-6">
            <button onclick="oauthLogin('google')" class="flex items-center justify-center gap-2 bg-white/5 border border-white/10 rounded-xl py-3 hover:bg-white/10 transition group">
                <i class="ri-google-fill text-xl text-white group-hover:scale-110 transition-transform"></i>
                <span class="text-sm font-semibold text-white">Google</span>
            </button>
            <button onclick="oauthLogin('github')" class="flex items-center justify-center gap-2 bg-white/5 border border-white/10 rounded-xl py-3 hover:bg-white/10 transition group">
                <i class="ri-github-fill text-xl text-white group-hover:scale-110 transition-transform"></i>
                <span class="text-sm font-semibold text-white">GitHub</span>
            </button>
        </div>
        
        <div class="relative flex items-center justify-center mb-6">
            <div class="absolute inset-0 border-t border-white/10"></div>
            <span class="relative bg-[#0A0A0A] px-2 text-xs text-white/40 uppercase">Or email</span>
        </div>
        
        <form id="signupForm" class="flex flex-col gap-3">
            <input type="email" id="email" name="email" placeholder="name@company.com" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-blue-500 transition-colors" required>
            <input type="password" id="password" name="password" placeholder="Create Password" class="w-full bg-white/5 border border-white/10 rounded-xl p-4 text-white focus:outline-none focus:border-blue-500 transition-colors" required>
            
            <button type="submit" id="submitBtn" class="w-full bg-white text-black font-bold rounded-xl py-4 mt-2 hover:scale-[1.02] active:scale-[0.98] transition-all relative overflow-hidden">
                <span id="btnText">Create Account</span>
            </button>
        </form>
        
        <div class="mt-6 text-xs text-neutral-500 font-medium">
            <span>Already a member?</span>
            <a href="/login" class="text-white hover:text-blue-400 font-bold ml-1 transition-colors">Log in</a>
        </div>
    </div>
</div>

<script>
    // --- 1. OAUTH HANDLER (Direct Server Redirect) ---
    function oauthLogin(provider) {
        // Hamare Python backend route par bhej do jo handshake handle karega
        // Redirect Base: /api/auth/login/{provider}
        window.location.href = `/api/auth/login/${provider}`;
    }
    
    // --- 2. MANUAL SIGNUP HANDLER ---
    document.getElementById('signupForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const btn = document.getElementById('submitBtn');
        const btnText = document.getElementById('btnText');
        const originalText = btnText.innerText;
        
        // Loading State
        btnText.innerText = "Securing account...";
        btn.disabled = true;
        btn.classList.add('opacity-50', 'cursor-not-allowed');
        
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        
        try {
            // Hamare naye /api/auth/register endpoint ko hit karein
            const response = await fetch('/api/auth/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });
            
            const data = await response.json();
            
            if (!response.ok) {
                throw new Error(data.detail || "Signup failed");
            }
            
            // --- SUCCESS HANDLING ---
            // Registration ke baad seedha login page par bhej do
            alert("✅ Account created successfully! Please log in.");
            window.location.href = "/login";
            
        } catch (err) {
            console.error("Signup Error:", err);
            alert("❌ " + err.message);
            
            // Reset Loading State
            btnText.innerText = originalText;
            btn.disabled = false;
            btn.classList.remove('opacity-50', 'cursor-not-allowed');
        }
    });
</script>
{% endblock %}