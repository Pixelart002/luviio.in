{% extends "app/base.html" %}

{% from "macros/index_page/header.html" import render_header %}
{% from "macros/index_page/drawer.html" import render_drawer %}
{% from "macros/index_page/footer.html" import render_footer %}
{% from "macros/index_page/hero.html" import render_hero %}

{% block header %}
{{ render_header() }}
{% endblock %}

{% block content %}
<!-- Drawer -->
{{ render_drawer() }}

<!-- Main content -->
<div id="main-content" class="w-full">
  {{ render_hero() }}
  
  <!-- SECTION 1: INFINITE MARQUEE (kept) -->
  <section class="py-16 bg-slate-900 overflow-hidden">
    <div class="marquee-container relative">
      <div class="marquee-track flex whitespace-nowrap will-change-transform">
        <span class="text-7xl md:text-8xl font-['Playfair_Display'] italic text-white/10 mx-8">✦ ALBUM FLICKER ✦</span>
        <span class="text-7xl md:text-8xl font-['Playfair_Display'] italic text-white/10 mx-8">✦ 3D MOTION ✦</span>
        <span class="text-7xl md:text-8xl font-['Playfair_Display'] italic text-white/10 mx-8">✦ SCROLL MAGIC ✦</span>
        <span class="text-7xl md:text-8xl font-['Playfair_Display'] italic text-white/10 mx-8">✦ GSAP PRO ✦</span>
      </div>
    </div>
  </section>
  
  <!-- SECTION 2: ALBUM FLICKER GRID (kept) -->
  <section class="relative w-full min-h-screen bg-slate-800 py-24 perspective">
    <div class="max-w-7xl mx-auto px-6 text-center mb-16">
      <h2 class="font-['Playfair_Display'] text-5xl md:text-6xl text-white">Image Album Flicker</h2>
      <p class="text-slate-300 text-lg mt-4">Staggered 3D flip with scroll trigger</p>
    </div>
    
    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 max-w-6xl mx-auto px-6" id="flicker-grid">
      <!-- Cards will be populated by JS -->
    </div>
  </section>
  
  <!-- SECTION 3: HORIZONTAL SCROLL GALLERY (replaces old card stack) -->
  <section id="horizontal-scroll-section" class="relative w-full h-screen bg-slate-900 overflow-hidden">
    <div class="sticky top-0 h-screen flex items-center">
      <div class="horizontal-scroll-track flex gap-8 px-16 will-change-transform" id="horizontal-track">
        <!-- Cards will be inserted by JS -->
      </div>
    </div>
  </section>
</div>

{{ render_footer() }}
{% endblock %}

{% block scripts %}
<!-- Vanilla JS for drawer toggling (unchanged) -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const drawer = document.getElementById('drawer');
    const overlay = document.getElementById('drawerOverlay');
    const closeBtn = document.getElementById('closeDrawerBtn');
    const drawerLinks = drawer ? drawer.querySelectorAll('a') : [];
    
    function openDrawer() {
      if (drawer) {
        drawer.classList.remove('-translate-x-full');
        overlay.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        
        const spans = hamburgerBtn?.querySelectorAll('span');
        if (spans && spans.length === 3) {
          spans[0].style.transform = 'rotate(45deg) translateY(9px)';
          spans[1].style.opacity = '0';
          spans[2].style.transform = 'rotate(-45deg) translateY(-9px)';
        }
      }
    }
    
    function closeDrawer() {
      if (drawer) {
        drawer.classList.add('-translate-x-full');
        overlay.classList.add('hidden');
        document.body.style.overflow = '';
        
        const spans = hamburgerBtn?.querySelectorAll('span');
        if (spans && spans.length === 3) {
          spans[0].style.transform = 'rotate(0) translateY(0)';
          spans[1].style.opacity = '1';
          spans[2].style.transform = 'rotate(0) translateY(0)';
        }
      }
    }
    
    if (hamburgerBtn) hamburgerBtn.addEventListener('click', openDrawer);
    if (closeBtn) closeBtn.addEventListener('click', closeDrawer);
    if (overlay) overlay.addEventListener('click', closeDrawer);
    
    drawerLinks.forEach(link => link.addEventListener('click', closeDrawer));
    
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && drawer && !drawer.classList.contains('-translate-x-full')) {
        closeDrawer();
      }
    });
  });
</script>

<!-- GSAP ADVANCED ANIMATIONS (updated with horizontal scroll) -->
<script>
  (function() {
    if (typeof gsap === 'undefined') return;
    gsap.registerPlugin(ScrollTrigger);
    
    // --- 1. INFINITE MARQUEE ---
    const marqueeTrack = document.querySelector('.marquee-track');
    if (marqueeTrack) {
      const marqueeContent = marqueeTrack.innerHTML;
      marqueeTrack.innerHTML += marqueeContent;
      const trackWidth = marqueeTrack.scrollWidth / 2;
      
      gsap.to(marqueeTrack, {
        x: -trackWidth,
        duration: 20,
        ease: "none",
        repeat: -1,
        modifiers: {
          x: (x) => parseFloat(x) % trackWidth + 'px'
        }
      });
    }
    
    // --- 2. ALBUM FLICKER GRID (unchanged) ---
    const grid = document.getElementById('flicker-grid');
    if (grid) {
      const images = [
        'https://images.unsplash.com/photo-1618220179428-22790b461013?w=400&q=80',
        'https://images.unsplash.com/photo-1618219944342-824e40a1328e?w=400&q=80',
        'https://images.unsplash.com/photo-1584622650111-993a426fbf0a?w=400&q=80',
        'https://images.unsplash.com/photo-1600566753086-00f18fb6b3ea?w=400&q=80',
        'https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?w=400&q=80',
        'https://images.unsplash.com/photo-1616046229478-9901c5536a45?w=400&q=80',
        'https://images.unsplash.com/photo-1604014237800-1c9102c219da?w=400&q=80',
        'https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=400&q=80'
      ];
      
      images.forEach((src, i) => {
        const card = document.createElement('div');
        card.className = 'flicker-card aspect-[3/4] rounded-2xl overflow-hidden shadow-2xl';
        card.style.background = `url(${src}) center/cover`;
        card.style.transform = 'rotateY(0deg) rotateX(0deg)';
        card.style.transformStyle = 'preserve-3d';
        card.style.boxShadow = '0 20px 40px rgba(0,0,0,0.6)';
        grid.appendChild(card);
      });
      
      gsap.from('.flicker-card', {
        scrollTrigger: {
          trigger: '#flicker-grid',
          start: 'top 80%',
          end: 'bottom 20%',
          scrub: 1
        },
        rotationY: (i) => i % 2 === 0 ? 180 : -180,
        rotationX: 15,
        opacity: 0,
        stagger: 0.1,
        duration: 2,
        ease: 'power2.inOut'
      });
    }
    
    // --- 3. HORIZONTAL SCROLL GALLERY (new) ---
    const track = document.getElementById('horizontal-track');
    if (track) {
      // Clear any existing content
      track.innerHTML = '';
      
      // Create cards with images (same set or new ones)
      const images = [
        'https://images.unsplash.com/photo-1618220179428-22790b461013?w=600&q=80',
        'https://images.unsplash.com/photo-1618219944342-824e40a1328e?w=600&q=80',
        'https://images.unsplash.com/photo-1584622650111-993a426fbf0a?w=600&q=80',
        'https://images.unsplash.com/photo-1600566753086-00f18fb6b3ea?w=600&q=80',
        'https://images.unsplash.com/photo-1616486338812-3dadae4b4ace?w=600&q=80',
        'https://images.unsplash.com/photo-1616046229478-9901c5536a45?w=600&q=80',
        'https://images.unsplash.com/photo-1604014237800-1c9102c219da?w=600&q=80',
        'https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=600&q=80'
      ];
      
      images.forEach((src, index) => {
        const card = document.createElement('div');
        card.className = 'horizontal-card w-[300px] h-[400px] flex-shrink-0 rounded-2xl overflow-hidden shadow-2xl';
        card.style.background = `url(${src}) center/cover`;
        card.style.border = '2px solid rgba(255,255,255,0.15)';
        card.style.boxShadow = '0 30px 50px rgba(0,0,0,0.7)';
        
        // Optional overlay text
        const overlay = document.createElement('div');
        overlay.className = 'absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 to-transparent text-white';
        overlay.innerHTML = `<h3 class="text-2xl font-bold">Image ${index+1}</h3>`;
        card.appendChild(overlay);
        
        track.appendChild(card);
      });
      
      // Calculate scroll width
      const scrollWidth = track.scrollWidth - window.innerWidth;
      
      // Pin and scrub horizontal scroll
      gsap.to(track, {
        x: -scrollWidth,
        ease: "none",
        scrollTrigger: {
          trigger: "#horizontal-scroll-section",
          start: "top top",
          end: () => `+=${scrollWidth + window.innerHeight}`,
          pin: true,
          scrub: 1.5,
          anticipatePin: 1,
          invalidateOnRefresh: true
        }
      });
      
      // Optional: fade in cards on enter
      gsap.from('.horizontal-card', {
        scrollTrigger: {
          trigger: "#horizontal-scroll-section",
          start: "top 80%",
          toggleActions: "play none none none"
        },
        opacity: 0,
        scale: 0.8,
        duration: 1,
        stagger: 0.2,
        ease: "power2.out"
      });
    }
  })();
</script>
{% endblock %}