{% extends "app/base.html" %}

{# --- 1. STRICT IMPORTS (Path: app/macros/index_page/) --- #}
{% from "app/macros/index_page/header.html"  import render_header %}
{% from "app/macros/index_page/nav.html"     import render_nav %}
{% from "app/macros/index_page/main.html"    import render_main_wrapper %}
{% from "app/macros/index_page/section.html" import render_section %}
{% from "app/macros/index_page/article.html" import render_article %}
{% from "app/macros/index_page/aside.html"   import render_aside %}
{% from "app/macros/index_page/footer.html"  import render_footer %}

{# --- 2. PAGE CONFIGURATION --- #}
{% block title %}Dashboard | Luviio Beast{% endblock %}

{# --- 3. PAGE COMPOSITION --- #}
{% block body_content %}

{# A. HEADER (Z-Index 50) #}
{{ render_header(user=state.user_info) }}

{# B. NAVIGATION (Overlay Z-Index 50) #}
{{ render_nav(active_page='home', items=state.nav_items) }}

{# C. MAIN WRAPPER (Z-Index 0) #}
{# Wraps the grid layout #}
{% call render_main_wrapper() %}

{# LEFT COL: Content Feeds (Span 8) #}
<div class="lg:col-span-8 flex flex-col gap-8">
    {% call render_section(title="System Feeds", id="feeds") %}
    
    {% if state.articles %}
    {% for article in state.articles %}
    {{ render_article(
                            title=article.title,
                            content=article.content,
                            badge=article.badge,
                            date=article.date
                        ) }}
    {% endfor %}
    {% else %}
    <div class="p-12 text-center text-slate-400 bg-white/50 border border-dashed border-slate-200 rounded-xl">
        <p>No active feeds available.</p>
    </div>
    {% endif %}
    
    {% endcall %}
</div>

{# RIGHT COL: Sidebar (Span 4) #}
<div class="lg:col-span-4">
    {{ render_aside(
                title="Live Diagnostics", 
                stats=state.system_stats,
                notifications=state.alerts
            ) }}
</div>

{% endcall %}

{# D. FOOTER #}
{{ render_footer(version="2.1.0") }}

{% endblock %}

{# --- 4. BEAST ANIMATION TRIGGERS --- #}
{% block page_scripts %}
<script>
    // Trigger GSAP animations when this specific page loads
    document.addEventListener("DOMContentLoaded", () => {
        if (typeof playPageLoadAnimation === 'function') {
            playPageLoadAnimation();
        }
    });
    
    // Re-trigger on Unpoly update (if navigating back to home)
    up.on('up:fragment:inserted', (event) => {
        if (event.target.matches('#main-content') || event.target.closest('#main-content')) {
            if (typeof playPageLoadAnimation === 'function') {
                playPageLoadAnimation();
            }
        }
    });
</script>
{% endblock %}