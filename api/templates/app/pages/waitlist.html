{% extends "app/base.html" %}

{% block content %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<div class="fixed inset-0 pointer-events-none z-0 flex items-center justify-center overflow-hidden">
    <div class="w-[500px] h-[500px] md:w-[800px] md:h-[800px] bg-blue-600/10 rounded-full blur-[100px] ambient-glow opacity-0 scale-50"></div>
</div>

<div class="relative z-10 min-h-[100dvh] flex flex-col items-center justify-center px-4 overflow-hidden font-sans">
    
    <div class="w-full max-w-5xl mx-auto flex flex-col items-center text-center">
        
        <div class="pill opacity-0 translate-y-8 mb-8">
            <span class="inline-block px-4 py-1.5 rounded-full border border-white/10 bg-white/[0.02] backdrop-blur-md text-[10px] md:text-xs font-bold tracking-[0.2em] text-neutral-400 uppercase shadow-xl shadow-black/20">
                Verified Access â€¢ 2026
            </span>
        </div>
        
        <h1 class="hero-title opacity-0 translate-y-10 blur-sm scale-95 text-4xl sm:text-6xl md:text-7xl lg:text-8xl font-black tracking-tighter text-white mb-6 leading-[0.9]">
            The Operating System <br class="hidden sm:block" />
            <span class="bg-gradient-to-b from-white to-white/40 bg-clip-text text-transparent">
                for Listings.
            </span>
        </h1>
        
        <p class="hero-desc opacity-0 translate-y-8 text-sm md:text-lg text-neutral-400 max-w-lg mb-12 leading-relaxed font-medium">
            We are rebuilding marketplace infrastructure from the ground up.
            <br class="hidden md:block" />
            Join the API-first future.
        </p>

        <div class="form-container opacity-0 w-full max-w-md relative group">
            <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500/30 to-purple-500/30 rounded-full blur opacity-0 group-hover:opacity-100 transition duration-1000"></div>
            
            <form id="waitlistForm" class="relative flex items-center p-1.5 rounded-full bg-[#0A0A0A] border border-white/10 shadow-2xl shadow-black/50 transition-colors focus-within:border-white/20">
                
                <input 
                    type="email" 
                    id="email" 
                    class="w-full bg-transparent text-white placeholder-neutral-600 px-6 py-4 text-base outline-none font-medium rounded-l-full"
                    placeholder="Enter your email address" 
                    required 
                    autocomplete="off"
                >
                
                <button 
                    type="submit" 
                    id="submitBtn" 
                    class="submit-btn relative overflow-hidden bg-white text-black h-12 px-8 rounded-full font-bold text-xs md:text-sm uppercase tracking-widest hover:bg-neutral-200 transition-colors shrink-0 flex items-center justify-center gap-2 will-change-transform"
                >
                    <span class="btn-text relative z-10">Join</span>
                    <div class="spinner hidden w-4 h-4 border-2 border-black/20 border-l-black rounded-full animate-spin"></div>
                </button>
            </form>
        </div>
    </div>

    <div id="toast" class="fixed bottom-10 left-1/2 -translate-x-1/2 flex items-center gap-3 px-6 py-3 bg-[#0A0A0A] border border-white/10 rounded-full shadow-2xl opacity-0 translate-y-8 pointer-events-none transition-all duration-500 z-50 backdrop-blur-md">
        <span id="toastIcon" class="text-lg">âœ¨</span>
        <span id="toastMsg" class="text-xs md:text-sm font-bold text-white tracking-wide">Success</span>
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        
        // --- A. GSAP ENTRANCE TIMELINE ---
        const tl = gsap.timeline({ defaults: { ease: "power4.out" } });

        // 1. Ambient Glow Expands
        tl.to(".ambient-glow", { 
            opacity: 1, 
            scale: 1, 
            duration: 2.5, 
            ease: "sine.out" 
        });

        // 2. Pill Snaps In
        tl.to(".pill", { 
            opacity: 1, 
            y: 0, 
            duration: 1.2 
        }, "-=2");

        // 3. Title Focuses (Blur -> Sharp)
        tl.to(".hero-title", { 
            opacity: 1, 
            y: 0, 
            scale: 1, 
            filter: "blur(0px)", 
            duration: 1.5,
            stagger: 0.1
        }, "-=1");

        // 4. Form Slides Up
        tl.to([".hero-desc", ".form-container"], { 
            opacity: 1, 
            y: 0, 
            duration: 1, 
            stagger: 0.15 
        }, "-=1.2");


        // --- B. MAGNETIC BUTTON LOGIC ---
        const btn = document.querySelector('.submit-btn');
        if (btn) {
            btn.addEventListener('mousemove', (e) => {
                const rect = btn.getBoundingClientRect();
                const x = e.clientX - rect.left - rect.width / 2;
                const y = e.clientY - rect.top - rect.height / 2;
                
                // Move button slightly towards cursor
                gsap.to(btn, {
                    x: x * 0.25, 
                    y: y * 0.25,
                    duration: 0.3,
                    ease: "power2.out"
                });
            });

            btn.addEventListener('mouseleave', () => {
                // Snap back to center
                gsap.to(btn, { x: 0, y: 0, duration: 0.6, ease: "elastic.out(1, 0.5)" });
            });
        }

        // --- C. FORM SUBMISSION LOGIC ---
        const form = document.getElementById('waitlistForm');
        const emailInput = document.getElementById('email');
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toastMsg');
        const toastIcon = document.getElementById('toastIcon');
        const btnText = document.querySelector('.btn-text');
        const spinner = document.querySelector('.spinner');

        const showToast = (msg, isError = false) => {
            toastMsg.innerText = msg;
            toastIcon.innerText = isError ? "âš ï¸" : "âœ¨";
            toast.style.borderColor = isError ? '#ef4444' : 'rgba(255,255,255,0.1)';
            
            // Show Toast
            toast.classList.remove('opacity-0', 'translate-y-8');
            
            // Hide after 4s
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-8');
            }, 4000);
        };

        const setLoading = (isLoading) => {
            btn.disabled = isLoading;
            if (isLoading) {
                btnText.classList.add('hidden');
                spinner.classList.remove('hidden');
                // Morph button to circle
                gsap.to(btn, { width: 48, padding: 0, duration: 0.3 }); 
            } else {
                btnText.classList.remove('hidden');
                spinner.classList.add('hidden');
                // Morph back to pill
                gsap.to(btn, { width: "auto", padding: "0 2rem", duration: 0.3 }); 
            }
        };

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = emailInput.value.trim();

            if (!email || !email.includes('@')) {
                showToast("Please enter a valid email.", true);
                return;
            }

            setLoading(true);

            try {
                // Call Backend API
                const res = await fetch('/waitlist', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: email })
                });
                
                const data = await res.json();

                if (!res.ok) throw new Error(data.error || "Failed");

                // Success State
                showToast(data.message || "Welcome to the future. ðŸš€");
                emailInput.value = "";
                
                setLoading(false);
                
                // Visual feedback on button
                btn.style.backgroundColor = "#22c55e"; // Green
                btn.style.color = "white";
                btnText.innerText = "Joined";
                
                // Celebrate bump
                gsap.fromTo(btn, { scale: 0.9 }, { scale: 1, duration: 0.4, ease: "elastic.out" });

            } catch (err) {
                console.error(err);
                setLoading(false);
                
                if (err.message.includes("already") || err.message.includes("list")) {
                    showToast("You're already on the list! âœ¨");
                } else {
                    showToast("Something went wrong. Try again.", true);
                }
            }
        });
    });
</script>
{% endblock %}