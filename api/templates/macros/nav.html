{# --- macros/nav.html --- #}

{% macro render_header(active_page='home', request=none) %}

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<header id="main-header" class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 border-b border-transparent bg-transparent">
    <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
        
        <a href="/" class="flex items-center gap-3 gsap-logo opacity-0 group cursor-pointer">
            <div class="w-9 h-9 bg-white rounded-xl flex items-center justify-center shadow-[0_0_15px_rgba(255,255,255,0.3)] transition-transform group-hover:scale-95">
                <span class="font-black text-xs text-black">l</span>
            </div>
            <span class="font-black tracking-[0.3em] text-white text-sm group-hover:opacity-80 transition-opacity">luviio</span>
        </a>
        
        <nav class="hidden md:flex items-center gap-10 text-[11px] font-black uppercase tracking-[0.2em] text-neutral-500">
            <a href="/" class="gsap-link relative hover:text-white transition-colors {{ 'text-white' if active_page == 'home' }}">
                Home
                {% if active_page == 'home' %}<span class="absolute -bottom-2 left-0 w-full h-[1px] bg-white shadow-[0_0_10px_white]"></span>{% endif %}
            </a>
            <a href="/waitlist" class="gsap-link relative hover:text-white transition-colors {{ 'text-white' if active_page == 'waitlist' }}">
                Waitlist
                {% if active_page == 'waitlist' %}<span class="absolute -bottom-2 left-0 w-full h-[1px] bg-white shadow-[0_0_10px_white]"></span>{% endif %}
            </a>
            <a href="#" class="gsap-link relative hover:text-white transition-colors">
                Marketplace
            </a>
        </nav>
        
        <div class="flex items-center gap-6">
            <div class="hidden md:flex items-center gap-6 gsap-auth opacity-0">
                {% if request and request.cookies.get("access_token") %}
                <a href="/dashboard" class="text-[11px] font-black text-white uppercase tracking-widest flex items-center gap-2 bg-white/10 px-4 py-2 rounded-lg border border-white/10 hover:bg-white/20 hover:scale-105 active:scale-95 transition-all duration-300">
                    Console <i class="ri-arrow-right-up-line"></i>
                </a>
                {% else %}
                <a href="/login" class="text-[11px] font-black text-white uppercase tracking-widest hover:opacity-70 transition">Sign In</a>
                <a href="/signup" class="bg-white text-black text-[11px] font-black uppercase tracking-widest px-6 py-3 rounded-xl hover:scale-105 active:scale-95 transition-all shadow-[0_0_20px_rgba(255,255,255,0.2)]">
                    Join Network
                </a>
                {% endif %}
            </div>

            <button id="mobile-toggle" class="md:hidden text-white focus:outline-none opacity-0 gsap-auth relative w-8 h-8 flex flex-col justify-center items-end gap-1.5 group">
                <span id="line1" class="w-6 h-0.5 bg-white transition-all duration-300"></span>
                <span id="line2" class="w-4 h-0.5 bg-white transition-all duration-300 group-hover:w-6"></span>
            </button>
        </div>
    </div>
</header>

<div id="mobile-menu" class="fixed inset-0 bg-black/95 z-[60] flex flex-col items-center justify-center hidden opacity-0 backdrop-blur-3xl">
    <button id="mobile-close" class="absolute top-6 right-6 text-white/50 hover:text-white p-4">
        <i class="ri-close-line text-3xl"></i>
    </button>

    <nav class="flex flex-col items-center gap-8 text-center">
        <a href="/" class="mobile-link text-3xl font-black text-white uppercase tracking-widest opacity-0 transform translate-y-8 hover:text-blue-400 transition-colors">Home</a>
        <a href="/waitlist" class="mobile-link text-3xl font-black text-white uppercase tracking-widest opacity-0 transform translate-y-8 hover:text-blue-400 transition-colors">Waitlist</a>
        <a href="#" class="mobile-link text-3xl font-black text-neutral-600 uppercase tracking-widest opacity-0 transform translate-y-8">Marketplace</a>
        
        <div class="w-12 h-[1px] bg-white/20 my-6 mobile-link opacity-0"></div>

        {% if request and request.cookies.get("access_token") %}
        <a href="/dashboard" class="mobile-link text-lg font-bold text-blue-400 uppercase tracking-widest opacity-0 transform translate-y-8 border border-blue-500/30 px-6 py-3 rounded-lg bg-blue-500/10">
            Go to Console
        </a>
        {% else %}
        <a href="/login" class="mobile-link text-lg font-bold text-white uppercase tracking-widest opacity-0 transform translate-y-8">Sign In</a>
        <a href="/signup" class="mobile-link px-8 py-4 bg-white text-black font-black uppercase tracking-widest rounded-full opacity-0 transform translate-y-8 shadow-[0_0_30px_rgba(255,255,255,0.3)]">
            Join Network
        </a>
        {% endif %}
    </nav>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        // --- A. INITIAL LOAD ANIMATION ---
        const tl = gsap.timeline({ defaults: { ease: "power4.out" } });

        // 1. Logo snaps in
        tl.fromTo(".gsap-logo", 
            { y: -30, opacity: 0, filter: "blur(10px)" },
            { y: 0, opacity: 1, filter: "blur(0px)", duration: 1.2 }
        );

        // 2. Nav links stagger in
        tl.fromTo(".gsap-link", 
            { y: -20, opacity: 0 },
            { y: 0, opacity: 1, duration: 0.8, stagger: 0.1 },
            "-=0.8"
        );

        // 3. Auth buttons slide from right
        tl.fromTo(".gsap-auth", 
            { x: 20, opacity: 0 },
            { x: 0, opacity: 1, duration: 0.8 },
            "-=0.8"
        );

        // --- B. SCROLL EFFECT ---
        window.addEventListener("scroll", () => {
            const header = document.getElementById("main-header");
            if (window.scrollY > 20) {
                gsap.to(header, { 
                    backgroundColor: "rgba(5, 5, 5, 0.6)", 
                    backdropFilter: "blur(12px)",
                    borderBottomColor: "rgba(255, 255, 255, 0.05)",
                    paddingTop: "0px",
                    paddingBottom: "0px",
                    duration: 0.4 
                });
            } else {
                gsap.to(header, { 
                    backgroundColor: "transparent", 
                    backdropFilter: "blur(0px)",
                    borderBottomColor: "transparent",
                    paddingTop: "0px",
                    paddingBottom: "0px",
                    duration: 0.4 
                });
            }
        });

        // --- C. MOBILE MENU LOGIC ---
        const toggleBtn = document.getElementById("mobile-toggle");
        const closeBtn = document.getElementById("mobile-close");
        const menu = document.getElementById("mobile-menu");
        const links = document.querySelectorAll(".mobile-link");
        
        let isMenuOpen = false;

        function toggleMenu(show) {
            isMenuOpen = show;
            if (show) {
                menu.classList.remove("hidden");
                gsap.to(menu, { opacity: 1, duration: 0.3 });
                gsap.to(links, { 
                    y: 0, 
                    opacity: 1, 
                    duration: 0.6, 
                    stagger: 0.1, 
                    ease: "back.out(1.2)" 
                });
            } else {
                gsap.to(links, { y: 20, opacity: 0, duration: 0.3 });
                gsap.to(menu, { 
                    opacity: 0, 
                    duration: 0.3, 
                    delay: 0.1,
                    onComplete: () => menu.classList.add("hidden")
                });
            }
        }

        if(toggleBtn) toggleBtn.addEventListener("click", () => toggleMenu(true));
        if(closeBtn) closeBtn.addEventListener("click", () => toggleMenu(false));
    });
</script>

{% endmacro %}