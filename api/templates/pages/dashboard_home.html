{% extends "active-layouts/index.html" if not up_fragment else "" %}
{% import "macros/components/stats_cards.html" as ui %}

{% block content %}
<div id="dashboard-container" class="space-y-8">
  <header class="flex flex-col md:flex-row md:items-center justify-between gap-4">
    <div>
      <h2 class="text-3xl font-black tracking-tighter">Command Center</h2>
      <p class="text-sm opacity-50">Real-time system health and commerce metrics.</p>
    </div>
    <div class="flex gap-2">
      <button class="btn btn-sm btn-outline btn-primary" up-target="#dashboard-container">
        <i class="ri-refresh-line"></i> Refresh
      </button>
      <button class="btn btn-sm btn-primary px-6">
        <i class="ri-download-2-line"></i> Export Report
      </button>
    </div>
  </header>
  
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
    {{ ui.stat_card('Total Revenue', stats.revenue, '+12.5%', 'ri-money-dollar-circle-line', 'primary') }}
    {{ ui.stat_card('Active Users', stats.users, '+5.2%', 'ri-user-heart-line', 'secondary') }}
    {{ ui.stat_card('New Orders', stats.orders, '-2.1%', 'ri-shopping-bag-3-line', 'accent') }}
    {{ ui.stat_card('Server Load', '24ms', 'Stable', 'ri-pulse-line', 'info') }}
  </div>
  
  <div class="grid grid-cols-1 xl:grid-cols-3 gap-6">
    <div class="xl:col-span-2 bg-base-100 rounded-2xl border border-white/5 overflow-hidden card-animate">
      <div class="p-4 border-b border-white/5 flex justify-between items-center bg-base-200/50">
        <h3 class="font-bold text-sm uppercase tracking-wider opacity-70">Recent Transactions</h3>
        <a href="/admin/orders" up-target="#main-content" class="btn btn-ghost btn-xs">View All</a>
      </div>
      <div class="overflow-x-auto">
        <table class="table table-zebra w-full">
          <thead>
            <tr class="opacity-50">
              <th>Transaction</th>
              <th>Status</th>
              <th>Amount</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for order in recent_orders %}
            <tr>
              <td>
                <div class="font-bold text-sm">{{ order.customer }}</div>
                <div class="text-xs opacity-50">{{ order.id }}</div>
              </td>
              <td><span class="badge badge-{{ order.status_color }} badge-sm">{{ order.status }}</span></td>
              <td class="font-mono text-sm">{{ order.amount }}</td>
              <th><button class="btn btn-ghost btn-xs">Details</button></th>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    
    <div class="bg-base-100 rounded-2xl border border-white/5 p-4 space-y-4 card-animate">
      <h3 class="font-bold text-sm uppercase tracking-wider opacity-70">System Integrity</h3>
      <div class="space-y-3">
        <div class="flex items-center gap-3 p-3 rounded-xl bg-success/10 border border-success/20">
          <i class="ri-shield-check-line text-success"></i>
          <span class="text-xs font-medium">Supabase Connection: Active</span>
        </div>
        <div class="flex items-center gap-3 p-3 rounded-xl bg-warning/10 border border-warning/20">
          <i class="ri-database-2-line text-warning"></i>
          <span class="text-xs font-medium">Backup completed 2h ago</span>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Unpoly compiler: Jab fragment load ho, tab stagger animation chale
  up.compiler('.card-animate', function(element) {
    gsap.from(element, {
      opacity: 0,
      y: 30,
      duration: 0.6,
      stagger: 0.1,
      ease: "back.out(1.4)",
      clearProps: "all"
    });
  });
</script>
{% endblock %}